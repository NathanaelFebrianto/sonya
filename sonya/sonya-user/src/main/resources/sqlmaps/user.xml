<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="user">
    <typeAlias alias="user" type="org.sonya.user.model.User"/>

    <resultMap id="userResult" class="user">
        <result property="id" column="id"/>
        <result property="sid" column="sid"/>
        <result property="username" column="username"/>
        <result property="password" column="password"/>
        <result property="roleId" column="role_id"/>        
        <result property="firstName" column="first_name"/>
        <result property="lastName" column="last_name"/>        
        <result property="passwordHintQuestion" column="password_hint_q"/>
        <result property="passwordHintAnswer" column="password_hint_a"/>
        <result property="company" column="company"/>
        <result property="department" column="department"/>
        <result property="jobLevel" column="job_level"/>
        <result property="postalCode" column="postal_code"/>
        <result property="address" column="address"/>
        <result property="addressDetail" column="address_detail"/>
        <result property="email" column="email"/>
        <result property="phoneNo" column="phone_no"/>
        <result property="mobileNo" column="mobile_no"/>
        <result property="website" column="website"/>
        <result property="use" column="use_yn"/>
        <result property="terminate" column="terminate_yn"/>
        <result property="terminateDate" column="terminate_date"/>
        <result property="insertDate" column="insert_date"/>
        <result property="updateDate" column="update_date"/>
        <result property="deleteDate" column="delete_date"/>
    </resultMap>

    <select id="getUsers" resultMap="userResult">
    <![CDATA[
        select * from t_user order by upper(username)
    ]]>
    </select>
    
    <select id="getUser" resultMap="userResult">
    <![CDATA[
        select * from t_user where id=#id#
    ]]>
    </select>

    <select id="getUserByUsername" resultMap="userResult">
    <![CDATA[
        select * from t_user where username=#username#
    ]]>
    </select>
    
	<select id="getUserPassword" resultClass="java.lang.String">
    <![CDATA[
        select password from t_user where username=#username#
    ]]>
    </select>
    
    <insert id="addUser" parameterClass="user">
    <![CDATA[
        insert into
        t_user (sid, username, password, role_id, first_name, last_name, 
	        password_hint_q, password_hint_a, company_name, department, job_level,
	        postal_code, address, address_detail, email, phone_no, mobile_no, 
	        website, use_yn, terminate_yn, terminate_date, 
	        insert_date, update_date, delete_date)
        values (#sid#, #username#, #password#, #roleId#, #firstName#, #lastName#, 
	        #passwordHintQuestion#, #passwordHintAnswer#, #company#, #department#, #jobLevel#,
	        #postalCode#, #address#, #addressDetail#, #email#, #phoneNo#, #mobileNo#, 
	        #website#, #use#, #terminate#, #terminateDate#, 
	        #insertDate#, #updateDate#, #deleteDate#)
    ]]>
        <selectKey resultClass="java.lang.String" keyProperty="id" type="post">
            select last_insert_id();
        </selectKey>
    </insert>    

    <update id="updateUser" parameterClass="user">
    <![CDATA[
        update t_user set
            sid = #sid#,
            username = #username#,
            password = #password#,
            role_id = #roleId#,
            first_name = #firstName#,
            last_name = #lastName#,
            password_hint_q = #passwordHintQuestion#, 
            password_hint_a = #passwordHintAnswer#,
            company = #company#,
            department = #department#,
            job_level = #jobLevel#,
            postal_code = #postalCode#,
            address = #address#,
            address_detail = #addressDetail#,
            email = #email#,
            phone_no = #phoneNo#,
            mobile_no = #mobileNo#,
            website = #website#,
            use_yn = #use#,
            terminate_yn = #terminate#,
            terminate_date = #terminateDate#,
            update_date = #updateDate#,
            delete_date = #deleteDate#,
        where id = #id#
    ]]>
    </update>
    
    <delete id="deleteUser" parameterClass="java.lang.String">
    <![CDATA[
        delete from t_user where id = #id#
    ]]>
    </delete>
</sqlMap>